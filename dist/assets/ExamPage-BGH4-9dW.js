import{j as d,B as R,T,aW as ne,aq as oe,r as M,ap as ie,Y as ae,d as $,u as se,C as ce,a2 as de,U as ue,G as W,az as D}from"./index-So8Y0uMi.js";import{E as le,S as he,a as fe}from"./ExamFooter-BDWwXu5v.js";import{R as pe,a as ve}from"./RadioGroup-Dgw4hZKm.js";import{s as ge,c as me}from"./MCATestApi-Ckt43_fe.js";const ye=({questionData:j,selectedOption:E,onSelect:_})=>d.jsxs(R,{p:3,bgcolor:"white",borderRadius:2,boxShadow:1,children:[d.jsx(T,{variant:"h6",gutterBottom:!0,children:"Question"}),d.jsx(T,{variant:"caption",color:"textSecondary",display:"block",gutterBottom:!0,children:"(Correct Answer: 1 Mark, Wrong Answer: -0.25 Mark)"}),d.jsx(T,{variant:"body1",gutterBottom:!0,children:j.question}),d.jsx(pe,{value:E,onChange:_,children:j.options.map((v,y)=>d.jsx(ne,{value:v,control:d.jsx(ve,{}),label:`${y+1}. ${v}`},y))})]});var V={exports:{}};(function(j,E){(function(v,y){j.exports=y(M)})(ie,function(_){return function(v){var y={};function a(r){if(y[r])return y[r].exports;var s=y[r]={i:r,l:!1,exports:{}};return v[r].call(s.exports,s,s.exports,a),s.l=!0,s.exports}return a.m=v,a.c=y,a.d=function(r,s,g){a.o(r,s)||Object.defineProperty(r,s,{enumerable:!0,get:g})},a.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},a.t=function(r,s){if(s&1&&(r=a(r)),s&8||s&4&&typeof r=="object"&&r&&r.__esModule)return r;var g=Object.create(null);if(a.r(g),Object.defineProperty(g,"default",{enumerable:!0,value:r}),s&2&&typeof r!="string")for(var w in r)a.d(g,w,(function(x){return r[x]}).bind(null,w));return g},a.n=function(r){var s=r&&r.__esModule?function(){return r.default}:function(){return r};return a.d(s,"a",s),s},a.o=function(r,s){return Object.prototype.hasOwnProperty.call(r,s)},a.p="",a(a.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(v,y,a){a.r(y);var r=a("react"),s=function(){var h=function(i,e){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o])},h(i,e)};return function(i,e){h(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}}(),g=function(){return g=Object.assign||function(h){for(var i,e=1,t=arguments.length;e<t;e++){i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(h[n]=i[n])}return h},g.apply(this,arguments)},w=function(h,i){var e={};for(var t in h)Object.prototype.hasOwnProperty.call(h,t)&&i.indexOf(t)<0&&(e[t]=h[t]);if(h!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,t=Object.getOwnPropertySymbols(h);n<t.length;n++)i.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(h,t[n])&&(e[t[n]]=h[t[n]]);return e};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(i){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return e?new Promise(function(t,n){e.call(navigator,i,t,n)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function x(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var q=function(h){s(i,h);function i(e){var t=h.call(this,e)||this;return t.canvas=null,t.ctx=null,t.requestUserMediaId=0,t.unmounted=!1,t.state={hasUserMedia:!1},t}return i.prototype.componentDidMount=function(){var e=this,t=e.state,n=e.props;if(this.unmounted=!1,!x()){n.onUserMediaError("getUserMedia not supported");return}t.hasUserMedia||this.requestUserMedia(),n.children&&typeof n.children!="function"&&console.warn("children must be a function")},i.prototype.componentDidUpdate=function(e){var t=this.props;if(!x()){t.onUserMediaError("getUserMedia not supported");return}var n=JSON.stringify(e.audioConstraints)!==JSON.stringify(t.audioConstraints),o=JSON.stringify(e.videoConstraints)!==JSON.stringify(t.videoConstraints),b=e.minScreenshotWidth!==t.minScreenshotWidth,p=e.minScreenshotHeight!==t.minScreenshotHeight;(o||b||p)&&(this.canvas=null,this.ctx=null),(n||o)&&(this.stopAndCleanup(),this.requestUserMedia())},i.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},i.stopMediaStream=function(e){e&&(e.getVideoTracks&&e.getAudioTracks?(e.getVideoTracks().map(function(t){e.removeTrack(t),t.stop()}),e.getAudioTracks().map(function(t){e.removeTrack(t),t.stop()})):e.stop())},i.prototype.stopAndCleanup=function(){var e=this.state;e.hasUserMedia&&(i.stopMediaStream(this.stream),e.src&&window.URL.revokeObjectURL(e.src))},i.prototype.getScreenshot=function(e){var t=this,n=t.state,o=t.props;if(!n.hasUserMedia)return null;var b=this.getCanvas(e);return b&&b.toDataURL(o.screenshotFormat,o.screenshotQuality)},i.prototype.getCanvas=function(e){var t=this,n=t.state,o=t.props;if(!this.video||!n.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var b=this.video.videoWidth,p=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var f=b/p;b=o.minScreenshotWidth||this.video.clientWidth,p=b/f,o.minScreenshotHeight&&p<o.minScreenshotHeight&&(p=o.minScreenshotHeight,b=p*f)}this.canvas=document.createElement("canvas"),this.canvas.width=(e==null?void 0:e.width)||b,this.canvas.height=(e==null?void 0:e.height)||p,this.ctx=this.canvas.getContext("2d")}var S=this,m=S.ctx,l=S.canvas;return m&&l&&(l.width=(e==null?void 0:e.width)||l.width,l.height=(e==null?void 0:e.height)||l.height,o.mirrored&&(m.translate(l.width,0),m.scale(-1,1)),m.imageSmoothingEnabled=o.imageSmoothing,m.drawImage(this.video,0,0,(e==null?void 0:e.width)||l.width,(e==null?void 0:e.height)||l.height),o.mirrored&&(m.scale(-1,1),m.translate(-l.width,0))),l},i.prototype.requestUserMedia=function(){var e=this,t=this.props,n=function(p,f){var S={video:typeof f<"u"?f:!0};t.audio&&(S.audio=typeof p<"u"?p:!0),e.requestUserMediaId++;var m=e.requestUserMediaId;navigator.mediaDevices.getUserMedia(S).then(function(l){e.unmounted||m!==e.requestUserMediaId?i.stopMediaStream(l):e.handleUserMedia(null,l)}).catch(function(l){e.handleUserMedia(l)})};if("mediaDevices"in navigator)n(t.audioConstraints,t.videoConstraints);else{var o=function(p){return{optional:[{sourceId:p}]}},b=function(p){var f=p.deviceId;return typeof f=="string"?f:Array.isArray(f)&&f.length>0?f[0]:typeof f=="object"&&f.ideal?f.ideal:null};MediaStreamTrack.getSources(function(p){var f=null,S=null;p.forEach(function(O){O.kind==="audio"?f=O.id:O.kind==="video"&&(S=O.id)});var m=b(t.audioConstraints);m&&(f=m);var l=b(t.videoConstraints);l&&(S=l),n(o(f),o(S))})}},i.prototype.handleUserMedia=function(e,t){var n=this.props;if(e||!t){this.setState({hasUserMedia:!1}),n.onUserMediaError(e);return}this.stream=t;try{this.video&&(this.video.srcObject=t),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(t)})}n.onUserMedia(t)},i.prototype.render=function(){var e=this,t=this,n=t.state,o=t.props,b=o.audio;o.forceScreenshotSourceSize;var p=o.disablePictureInPicture;o.onUserMedia,o.onUserMediaError,o.screenshotFormat,o.screenshotQuality,o.minScreenshotWidth,o.minScreenshotHeight,o.audioConstraints,o.videoConstraints,o.imageSmoothing;var f=o.mirrored,S=o.style,m=S===void 0?{}:S,l=o.children,O=w(o,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),F=f?g(g({},m),{transform:(m.transform||"")+" scaleX(-1)"}):m,N={getScreenshot:this.getScreenshot.bind(this)};return r.createElement(r.Fragment,null,r.createElement("video",g({autoPlay:!0,disablePictureInPicture:p,src:n.src,muted:!b,playsInline:!0,ref:function(Q){e.video=Q},style:F},O)),l&&l(N))},i.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},i}(r.Component);y.default=q},react:function(v,y){v.exports=_}}).default})})(V);var be=V.exports;const Se=oe(be),xe=({initialTime:j,onSubmit:E,onExit:_})=>{const[v,y]=M.useState(j);return M.useEffect(()=>{const a=setInterval(()=>{y(r=>{const[s,g,w]=r.split(":").map(Number);let x=s*3600+g*60+w-1;if(x<=0)return clearInterval(a),E(),"00:00:00";const q=String(Math.floor(x/3600)).padStart(2,"0"),h=String(Math.floor(x%3600/60)).padStart(2,"0"),i=String(x%60).padStart(2,"0");return`${q}:${h}:${i}`})},1e3);return()=>clearInterval(a)},[E]),d.jsxs(R,{p:2,bgcolor:"rgba(102, 225, 228, 0.3)",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",children:[d.jsx(R,{sx:{width:160,height:120,borderRadius:"8px",overflow:"hidden",border:"2px solid #66E1E4",mb:2},children:d.jsx(Se,{audio:!1,screenshotFormat:"image/jpeg",width:160,height:120,videoConstraints:{facingMode:"user"}})}),d.jsx(T,{variant:"h6",align:"center",children:v}),d.jsx(T,{variant:"caption",align:"center",display:"block",children:"Time Remaining"}),d.jsxs(ae,{spacing:2,mt:3,width:"100%",children:[d.jsx($,{variant:"contained",onClick:E,sx:{backgroundColor:"#43a047","&:hover":{backgroundColor:"#2e7d32"}},children:"Submit"}),d.jsx($,{variant:"contained",onClick:_,sx:{backgroundColor:"#e53935","&:hover":{backgroundColor:"#c62828"}},children:"Exit"})]})]})},Oe=()=>{const j=JSON.parse(sessionStorage.getItem("user")),E=se(),_=ce(E.breakpoints.down("sm")),[v,y]=M.useState([]),[a,r]=M.useState(1),[s,g]=M.useState({}),[w,x]=M.useState({}),[q,h]=M.useState(0),i=de(),e=ue(),{mcqData:t=[],selectedTopic:n={},selectedMode:o=""}=i.state||{},b=j==null?void 0:j.seekerId,p=n==null?void 0:n.topicId,f=o,S={"Content-type":"application/json",Authorization:"Bearer "+j.accessToken};M.useEffect(()=>{if(!t.length)alert("No MCQ data found. Redirecting..."),e("/jobs/tests");else{const u=t.map((c,U)=>({id:c.mcqId||U+1,question:c.question,options:[c.a,c.b,c.c,c.d],answer:c.answer}));y(u)}},[t,e]),M.useEffect(()=>{const u=()=>{document.hidden&&alert("Tab change or minimize detected! Please stay on the exam page.")};return document.addEventListener("visibilitychange",u),()=>{document.removeEventListener("visibilitychange",u)}},[]),M.useEffect(()=>{const u=Date.now(),c=new BroadcastChannel("exam_channel");let U=0;const P=setTimeout(()=>{U>0&&alert("Exam is already active in another tab. Closing this one.")},200);return c.postMessage({type:"new_tab_check",tabId:u}),c.onmessage=A=>{const{type:I,tabId:k}=A.data;I==="new_tab_check"&&k!==u&&c.postMessage({type:"existing_tab_response",tabId:u}),I==="existing_tab_response"&&k!==u&&(U+=1,h(C=>C+1))},()=>{clearTimeout(P),c.close()}},[]),M.useEffect(()=>{const u=c=>c.preventDefault();return document.addEventListener("contextmenu",u),()=>{document.removeEventListener("contextmenu",u)}},[]);const m=u=>{const c=u.target.value;g({...s,[a]:c}),x({...w,[a]:"answered"})},l=()=>{x({...w,[a]:"review"}),r(u=>Math.min(u+1,v.length))},O=()=>{g({...s,[a]:""}),x({...w,[a]:"not_answered"})},F=()=>{const u=s[a]?"answered":"not_answered";x({...w,[a]:u}),r(c=>Math.min(c+1,v.length))},N=()=>{const u=v.length;let c=0,U=0,P=0;v.forEach((k,C)=>{const L=s[C+1],B=k.answer;L&&(c++,L===B?U++:P++)});const A=u-c,I=U>=u/2?"Pass":"Fail";return{total:u,attempted:c,correct:U,wrong:P,unattempted:A,result:I}},Q=async()=>{const{total:u,attempted:c,correct:U,wrong:P,unattempted:A,result:I}=N(),k={seeker:{seekerId:b},topic:{topicId:p},mode:f,totalQuestions:u,attemptedQuestions:c,correctAnswers:U,wrongAnswers:P,unattempted:A,tabSwitchCount:q,result:I};try{const C=await ge(k,S);console.log("Exam history saved:",C);const L=C.id,B=t.map((G,ee)=>{const te=G.mcqId,re=G.question,J=G.answer,H=s[ee+1]||"",z=H===J;return me({examHistoryId:L,questionId:te,questionText:re,selectedAnswer:H,correctAnswer:J,isCorrect:z,scoreAwarded:z?1:0,penaltyApplied:H&&!z?-.25:0},S)});await Promise.all(B),D.fire("Success","Exam submitted successfully!","success"),e("/jobs/resultReview",{state:{historyId:C.id}})}catch(C){console.error("Failed to submit exam:",C),D.fire("Error","Failed to submit exam. Please try again.","error")}},K=()=>{window.confirm("Are you sure you want to exit the test?")&&e("/jobs/tests")},X=v[a-1]||{question:"",options:[]},Y=s[a]||"",Z=v.map((u,c)=>({id:c+1,status:w[c+1]||"not_answered"}));return d.jsxs(R,{display:"flex",flexDirection:"column",height:"100%",sx:{borderRadius:2,overflow:"hidden",boxShadow:3,bgcolor:"background.paper"},children:[d.jsx(le,{currentPage:a,totalPages:v.length}),d.jsxs(W,{container:!0,flex:1,children:[d.jsx(W,{item:!0,xs:12,sm:3,md:2,sx:{display:_?"none":"block",borderRight:1,borderColor:"divider"},children:d.jsx(he,{totalQuestions:v.length,currentQuestion:a,onNavigate:r,questionStatus:Z})}),d.jsx(W,{item:!0,xs:12,sm:6,md:8,p:2,children:d.jsx(ye,{questionData:X,selectedOption:Y,onSelect:m})}),d.jsx(W,{item:!0,xs:12,sm:3,md:2,sx:{borderLeft:1,borderColor:"divider"},children:d.jsx(xe,{initialTime:"00:20:00",onSubmit:Q,onExit:K})})]}),d.jsx(R,{children:d.jsx(fe,{onMarkReview:l,onClear:O,onSave:F,onSubmit:Q})})]})};export{Oe as default};
