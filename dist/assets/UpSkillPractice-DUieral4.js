import{U as k,r as s,j as e,B as j,P as z,T as r,G as n,D as O,F as g,h as v,S as b,d as F,az as c}from"./index-So8Y0uMi.js";import{d as G}from"./PlayArrow-fFRiTYJQ.js";import{f as U,g as _,a as H,b as J}from"./MCATestApi-Ckt43_fe.js";import{M as l}from"./MenuItem-CSdFaWhF.js";const $=()=>{const L=k(),[T,w]=s.useState(!0),[I,C]=s.useState([]),[x,M]=s.useState([]),[h,N]=s.useState([]),[p,W]=s.useState(""),[a,P]=s.useState(""),[o,R]=s.useState(""),[y,S]=s.useState(!1),u=s.useRef(Date.now()),B=s.useRef(null),q="Practice Assessment",E=20,f="PRACTICE",D=20,d={"Content-type":"application/json",Authorization:"Bearer "+JSON.parse(sessionStorage.getItem("user")).accessToken};s.useEffect(()=>{const t=new BroadcastChannel("exam_channel");return B.current=t,t.postMessage({type:"check",tabId:u.current}),t.onmessage=m=>{const{type:i,tabId:Q}=m.data;i==="check"?t.postMessage({type:"active",tabId:u.current}):i==="active"&&Q!==u.current&&w(!1)},()=>{t.close()}},[]),s.useEffect(()=>{U(d).then(t=>{C((t==null?void 0:t.content)||[])}).catch(t=>{console.error("Error fetching topics:",t)})},[]),s.useEffect(()=>{_(d).then(t=>{M(t||[])}).catch(t=>{console.error("Error fetching expertise levels:",t)})},[]),s.useEffect(()=>{H(d).then(t=>{N(t||[])}).catch(t=>{console.error("Error fetching experience levels:",t)})},[]);const A=async()=>{if(!T){alert("Another tab is open. Close it before starting.");return}if(!p){c.fire("Incomplete","Please select a topic","warning");return}if(!a){c.fire("Incomplete","Please select expertise level","warning");return}if(!o){c.fire("Incomplete","Please select experience level","warning");return}const t=I.find(i=>i.topicId===p);if(!t){c.fire("Error","Invalid topic selected","error");return}S(!0);const m={experienceId:parseInt(o),expertiseLevelId:parseInt(a),mcqTopicDTOList:[{topicId:t.topicId,topicName:t.topicName}],mode:f,numberOfQuestions:E};try{const i=await J(m,d);i&&i.length>0?L("/jobs/exam",{state:{mcqData:i,selectedTopic:t,selectedMode:f,expertiseLevelId:a,experienceId:o}}):c.fire("No Questions","No MCQs available for selected filters.","info")}catch(i){console.error("MCQ fetch error:",i),c.fire("Error","Something went wrong while fetching questions.","error")}finally{S(!1)}};return e.jsx(j,{sx:{bgcolor:"#f0f4f8",py:5,px:2,minHeight:"82%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsxs(z,{elevation:6,sx:{maxWidth:960,width:"100%",borderRadius:3,p:4},children:[e.jsx(r,{variant:"h4",fontWeight:600,color:"primary.main",mb:2,children:q}),e.jsxs(n,{container:!0,spacing:2,mb:3,children:[e.jsxs(n,{item:!0,xs:6,sm:3,children:[e.jsx(r,{variant:"subtitle2",children:"Total Questions"}),e.jsx(r,{variant:"body1",children:E})]}),e.jsxs(n,{item:!0,xs:6,sm:3,children:[e.jsx(r,{variant:"subtitle2",children:"Duration"}),e.jsxs(r,{variant:"body1",children:[D," Minutes"]})]}),e.jsxs(n,{item:!0,xs:6,sm:3,children:[e.jsx(r,{variant:"subtitle2",children:"Sections"}),e.jsx(r,{variant:"body1",children:"3"})]}),e.jsxs(n,{item:!0,xs:6,sm:3,children:[e.jsx(r,{variant:"subtitle2",children:"Mode"}),e.jsx(r,{variant:"body1",color:"primary",children:f})]})]}),e.jsx(O,{sx:{mb:3}}),e.jsx(r,{variant:"h5",fontWeight:600,gutterBottom:!0,children:"Instructions"}),e.jsxs(j,{component:"ul",sx:{pl:3,mb:3},children:[e.jsx("li",{children:e.jsx(r,{children:"Timed practice â€“ auto-submits when time ends."})}),e.jsx("li",{children:e.jsx(r,{children:"Practice mode only; results visible after submit."})}),e.jsx("li",{children:e.jsx(r,{children:"Unlimited attempts allowed."})}),e.jsx("li",{children:e.jsx(r,{children:"Review answers with correct solutions after submission."})})]}),e.jsxs(j,{sx:{mb:4,display:"flex",gap:3,flexWrap:"wrap"},children:[e.jsxs(g,{fullWidth:!0,sx:{minWidth:200,flex:1},children:[e.jsx(v,{children:"Select Topic"}),e.jsx(b,{value:p,label:"Select Topic",onChange:t=>W(t.target.value),children:I.map(t=>e.jsx(l,{value:t.topicId,children:t.topicName},t.topicId))})]}),e.jsxs(g,{fullWidth:!0,sx:{minWidth:200,flex:1},children:[e.jsx(v,{children:"Expertise Level"}),e.jsx(b,{value:a,onChange:t=>P(t.target.value),label:"Expertise Level",disabled:x.length===0,children:x.length===0?e.jsx(l,{disabled:!0,children:"Loading expertise levels..."}):x.map(t=>e.jsx(l,{value:t.expertiseLevelId,children:t.levelName},t.expertiseLevelId))})]}),e.jsxs(g,{fullWidth:!0,sx:{minWidth:200,flex:1},children:[e.jsx(v,{children:"Experience"}),e.jsx(b,{value:o,onChange:t=>R(t.target.value),label:"Experience",disabled:h.length===0,children:h.length===0?e.jsx(l,{disabled:!0,children:"Loading experience levels..."}):h.map(t=>e.jsx(l,{value:t.experienceId,children:t.experienceName||t.levelName||t.name},t.experienceId))})]})]}),e.jsx(n,{container:!0,spacing:2,justifyContent:"center",children:e.jsx(n,{item:!0,children:e.jsx(F,{variant:"contained",color:"primary",size:"large",endIcon:e.jsx(G,{}),onClick:A,disabled:y,sx:{px:4,py:1.5,fontSize:"16px",fontWeight:500},children:y?"Loading...":"Start Practice"})})})]})})};export{$ as default};
