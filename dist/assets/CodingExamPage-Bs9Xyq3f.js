import{j as e,B as p,T as i,P as z,aW as ae,D as ie,r as a,Y as ce,d as q,u as de,C as le,a2 as ue,U as he,G as I,az as G}from"./index-So8Y0uMi.js";import{E as me,S as pe,a as xe}from"./ExamFooter-BDWwXu5v.js";import{R as ge,a as be}from"./RadioGroup-Dgw4hZKm.js";import{s as we,c as fe}from"./MCATestApi-Ckt43_fe.js";const ve=({questionData:o,selectedAnswer:h,onAnswerChange:v,showAnswers:r})=>e.jsxs(p,{p:3,bgcolor:"white",borderRadius:2,boxShadow:1,children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Coding Question"}),e.jsx(i,{variant:"caption",color:"textSecondary",display:"block",gutterBottom:!0,children:o.questionType==="output"?"Guess the output of the following code:":"Find the error in the following code:"}),e.jsx(z,{elevation:2,sx:{p:2,bgcolor:"#f5f5f5",border:"1px solid #ddd",borderRadius:1,mb:3,fontFamily:"monospace"},children:e.jsx(i,{variant:"body2",component:"pre",sx:{whiteSpace:"pre-wrap",fontSize:"0.9rem",lineHeight:1.4,margin:0},children:o.codeSnippet})}),e.jsx(i,{variant:"subtitle2",gutterBottom:!0,children:"Select your answer:"}),e.jsx(ge,{value:h,onChange:v,children:o.options.map((u,n)=>e.jsx(ae,{value:u,control:e.jsx(be,{}),label:e.jsx(p,{sx:{fontFamily:"monospace",fontSize:"0.9rem"},children:u})},n))}),r&&e.jsxs(p,{sx:{mt:3},children:[e.jsx(ie,{sx:{mb:2}}),e.jsxs(z,{elevation:2,sx:{p:2,bgcolor:"#e8f5e8",border:"1px solid #4caf50",borderRadius:2},children:[e.jsx(i,{variant:"h6",color:"success.main",gutterBottom:!0,children:"Correct Answer:"}),e.jsx(p,{sx:{fontFamily:"monospace",fontSize:"0.9rem",mb:2},children:o.correctAnswer}),e.jsx(i,{variant:"h6",color:"success.main",gutterBottom:!0,children:"Explanation:"}),e.jsx(i,{variant:"body1",sx:{lineHeight:1.6},children:o.explanation}),o.concept&&e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"h6",color:"success.main",gutterBottom:!0,sx:{mt:2},children:"Key Concept:"}),e.jsx(i,{variant:"body1",sx:{lineHeight:1.6},children:o.concept})]})]})]})]}),Se=({initialTime:o,onSubmit:h,onExit:v,onShowAnswers:r,showAnswers:u})=>{const[n,S]=a.useState(o);return a.useEffect(()=>{const d=setInterval(()=>{S(C=>{const[m,x,T]=C.split(":").map(Number);let g=m*3600+x*60+T-1;if(g<=0)return clearInterval(d),h(),"00:00:00";const y=String(Math.floor(g/3600)).padStart(2,"0"),P=String(Math.floor(g%3600/60)).padStart(2,"0"),R=String(g%60).padStart(2,"0");return`${y}:${P}:${R}`})},1e3);return()=>clearInterval(d)},[h]),e.jsxs(p,{p:2,bgcolor:"rgba(102, 225, 228, 0.3)",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",children:[e.jsx(i,{variant:"h6",align:"center",sx:{mt:2},children:n}),e.jsx(i,{variant:"caption",align:"center",display:"block",sx:{mb:3},children:"Time Remaining"}),e.jsxs(ce,{spacing:2,width:"100%",children:[e.jsx(q,{variant:"contained",onClick:r,sx:{backgroundColor:u?"#ff9800":"#2196f3","&:hover":{backgroundColor:u?"#f57c00":"#1976d2"}},children:u?"Hide Answers":"Show Correct Answers"}),e.jsx(q,{variant:"contained",onClick:h,sx:{backgroundColor:"#43a047","&:hover":{backgroundColor:"#2e7d32"}},children:"Submit Practice"}),e.jsx(q,{variant:"contained",onClick:v,sx:{backgroundColor:"#e53935","&:hover":{backgroundColor:"#c62828"}},children:"Exit"})]})]})},Te=()=>{const o=JSON.parse(sessionStorage.getItem("user")),h=de(),v=le(h.breakpoints.down("sm")),[r,u]=a.useState([]),[n,S]=a.useState(1),[d,C]=a.useState({}),[m,x]=a.useState({}),[T,g]=a.useState(0),[y,P]=a.useState(!1),R=ue(),A=he(),{codingData:E=[],selectedTopic:M={},selectedMode:O=""}=R.state||{},U=o==null?void 0:o.seekerId,$=M==null?void 0:M.topicId,D=O,L={"Content-type":"application/json",Authorization:"Bearer "+o.accessToken};a.useEffect(()=>{if(!E.length)alert("No Coding data found. Redirecting..."),A("/jobs/coding-assessment");else{const s=E.slice(0,10).map((t,c)=>({id:t.codingId||c+1,question:t.question,questionType:t.questionType||"output",codeSnippet:t.codeSnippet,options:t.options||[],correctAnswer:t.correctAnswer,explanation:t.explanation,concept:t.concept||""}));u(s)}},[E,A]),a.useEffect(()=>{const s=()=>{document.hidden&&alert("Tab change or minimize detected! Please stay on the exam page.")};return document.addEventListener("visibilitychange",s),()=>{document.removeEventListener("visibilitychange",s)}},[]),a.useEffect(()=>{const s=Date.now(),t=new BroadcastChannel("exam_channel");let c=0;const b=setTimeout(()=>{c>0&&alert("Exam is already active in another tab. Closing this one.")},200);return t.postMessage({type:"new_tab_check",tabId:s}),t.onmessage=j=>{const{type:w,tabId:f}=j.data;w==="new_tab_check"&&f!==s&&t.postMessage({type:"existing_tab_response",tabId:s}),w==="existing_tab_response"&&f!==s&&(c+=1,g(l=>l+1))},()=>{clearTimeout(b),t.close()}},[]),a.useEffect(()=>{const s=t=>t.preventDefault();return document.addEventListener("contextmenu",s),()=>{document.removeEventListener("contextmenu",s)}},[]);const J=s=>{const t=s.target.value;C({...d,[n]:t}),x({...m,[n]:"answered"})},K=()=>{x({...m,[n]:"review"}),S(s=>Math.min(s+1,r.length))},V=()=>{C({...d,[n]:""}),x({...m,[n]:"not_answered"})},W=()=>{const s=d[n]?"answered":"not_answered";x({...m,[n]:s}),S(t=>Math.min(t+1,r.length))},Y=()=>{const s=r.length;let t=0,c=0,b=0;r.forEach((f,l)=>{const k=d[l+1],_=f.correctAnswer;k&&(t++,k===_?c++:b++)});const j=s-t,w=c>=s/2?"Pass":"Fail";return{total:s,attempted:t,correct:c,wrong:b,unattempted:j,result:w}},H=async()=>{const{total:s,attempted:t,correct:c,wrong:b,unattempted:j,result:w}=Y(),f={seeker:{seekerId:U},topic:{topicId:$},mode:D,totalQuestions:s,attemptedQuestions:t,correctAnswers:c,wrongAnswers:b,unattempted:j,tabSwitchCount:T,result:w};try{const l=await we(f,L);console.log("Exam history saved:",l);const k=l.id,_=E.map((B,ne)=>{const oe=B.codingId,re=B.question,N=B.correctAnswer,Q=d[ne+1]||"",F=Q===N;return fe({examHistoryId:k,questionId:oe,questionText:re,selectedAnswer:Q,correctAnswer:N,isCorrect:F,scoreAwarded:F?1:0,penaltyApplied:Q&&!F?-.25:0},L)});await Promise.all(_),G.fire("Success","Coding Practice submitted successfully!","success"),A("/jobs/resultReview",{state:{historyId:l.id}})}catch(l){console.error("Failed to submit exam:",l),G.fire("Error","Failed to submit exam. Please try again.","error")}},X=()=>{window.confirm("Are you sure you want to exit the test?")&&A("/jobs/coding-assessment")},Z=()=>{P(!y)},ee=r[n-1]||{question:"",options:[],codeSnippet:""},te=d[n]||"",se=r.map((s,t)=>({id:t+1,status:m[t+1]||"not_answered"}));return e.jsxs(p,{display:"flex",flexDirection:"column",height:"100%",sx:{borderRadius:2,overflow:"hidden",boxShadow:3,bgcolor:"background.paper"},children:[e.jsx(me,{currentPage:n,totalPages:r.length}),e.jsxs(I,{container:!0,flex:1,children:[e.jsx(I,{item:!0,xs:12,sm:3,md:2,sx:{display:v?"none":"block",borderRight:1,borderColor:"divider"},children:e.jsx(pe,{totalQuestions:r.length,currentQuestion:n,onNavigate:S,questionStatus:se})}),e.jsx(I,{item:!0,xs:12,sm:6,md:8,p:2,children:e.jsx(ve,{questionData:ee,selectedAnswer:te,onAnswerChange:J,showAnswers:y})}),e.jsx(I,{item:!0,xs:12,sm:3,md:2,sx:{borderLeft:1,borderColor:"divider"},children:e.jsx(Se,{initialTime:"00:30:00",onSubmit:H,onExit:X,onShowAnswers:Z,showAnswers:y})})]}),e.jsx(p,{children:e.jsx(xe,{onMarkReview:K,onClear:V,onSave:W,onSubmit:H})})]})};export{Te as default};
