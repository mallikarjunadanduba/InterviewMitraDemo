import{a as h,b as d,u as ee,r as c,j as e,M as te,G as y,g as se,P as ae,I as E,e as F,c as S,d as x}from"./index-So8Y0uMi.js";import{h as $}from"./moment-G82_0lEo.js";import{d as re}from"./Add-CKqOdQJH.js";import{d as oe}from"./Edit-C0O1oZMb.js";import{d as ne}from"./DeleteForever-CZXyAtfu.js";import{T as ce,a as ie,b as le,c as k,d as A,e as de}from"./TableRow-ByAOLB1Q.js";import{T as ue}from"./TablePagination-Bq1iu1it.js";import{D as he,a as me}from"./DialogTitle-B--fWyEw.js";import{D as pe}from"./DialogActions-Bk10_EIe.js";import"./LastPage-C7laYLYy.js";import"./MenuItem-CSdFaWhF.js";const ge=async o=>await h({method:"get",url:`${d}/success/v1/getAllSuccessStoryByPagination/{pageNumber}/{pageSize}?pageNumber=0&pageSize=10`,headers:o}),ye=async(o,l)=>await h({method:"GET",url:`${d}/success/v1/getSuccessStoryById/{successstoryId}?successstoryId=${o}`,headers:l}),fe=async(o,l)=>(console.log(o),await h({method:"PUT",url:`${d}/success/v1/updateSuccessStory`,headers:l,data:o}).then(function(s){console.log(s),s.data.responseCode===201?alert(s.data.message):s.data.responseCode===400&&alert(s.data.errorMessage)}).catch(function(s){console.log(s)})),xe=async(o,l)=>await h({method:"delete",url:`${d}/success/v1/deleteSuccessStoryById/${o}`,headers:l}).then(s=>{s.data.responseCode===200?alert(s.data.message):s.data.responseCode===400&&alert(s.data.errorMessage)}).catch(s=>{console.log(s)}),Se=async(o,l)=>{try{return await h({method:"POST",url:`${d}/success/v1/createSuccessStory`,headers:l,data:o}).then(function(s){console.log(s),s.data.responseCode===201?alert("Advertisement  added successfully"):s.data.responseCode===400&&alert(s.data.errorMessage)})}catch(s){alert(s)}},U=[{id:"successstoryId",label:"ID"},{id:"successstoryName",label:"Name",minWidth:100},{id:"description",label:"Description",minWidth:100},{id:"file",label:"File"},{id:"createdBy",label:"Created By",align:"right"},{id:"updatedBy",label:"Updated By",align:"right"},{id:"insertedDate",label:"Inserted Date",align:"right"},{id:"updatedDate",label:"Updated Date",align:"right"},{id:"actions",label:"Actions",align:"right"}],$e=()=>{ee();const[o,l]=c.useState(0),[s,W]=c.useState(10),[N,j]=c.useState([]),[b,w]=c.useState(!1),[M,m]=c.useState(!1),[R,z]=c.useState(null),[Ne,I]=c.useState(""),[u,D]=c.useState({}),[C,O]=c.useState(null),P=c.useRef(null),[je,v]=c.useState(""),[G,B]=c.useState(!1),[i,p]=c.useState({successstoryName:"",description:""}),H=(t,a)=>{l(a)},_=t=>{W(+t.target.value),l(0)},f=JSON.parse(sessionStorage.getItem("user")),g={"Content-type":"application/json",Authorization:`Bearer ${f.accessToken}`},L=`${d}/file/downloadFile/?filePath=`,J=async()=>{try{const a=(await ge(g)).data.content;if(a){const r=a.map(n=>({successstoryId:n.successstoryId,successstoryName:n.successstoryName,description:n.description,file:n.photoPath?e.jsx("img",{src:L+n.photoPath,alt:n.photoName,style:{width:100,height:50}}):"NO IMAGE FOUND",insertedDate:$(n.insertedDate).format("L"),updatedDate:$(n.updatedDate).format("L"),createdBy:n.createdBy?n.createdBy.userName:"No User",updatedBy:n.updatedBy?n.updatedBy.userName:"No User"}));j(r)}else j([])}catch(t){console.error("Error fetching data:",t)}};c.useEffect(()=>{J()},[G]);const V=()=>{const t={};return i.successstoryName.trim()||(t.successstoryName="Enter the News"),i.description.trim()||(t.description="Enter the Description"),(!i.photoName||i.photoName.trim()==="")&&(t.photoName="Select the file"),t},T=t=>{p({...i,[t.target.name]:t.target.value}),D(a=>({...a,[t.target.name]:null}))},q=async t=>{try{await xe(t,g),B(a=>!a)}catch(a){console.error("Error deleting news:",a)}},K=async t=>{w(!0),m(!0);try{const r=(await ye(t,g)).data;z(r.successstoryId),p({successstoryName:r.successstoryName,description:r.description,photoName:r.photoName})}catch(a){console.error("Error fetching news by ID:",a)}},Q=async t=>{if(t.preventDefault(),!C){v("Please select a file");return}const a=new FormData;a.append("file",C);try{const r=await h.post(`${d}/file/uploadFile`,a,{headers:{"content-type":"multipart/form-data",Authorization:`Bearer ${f.accessToken}`}});I(r.data.fileName),p(n=>({...n,photoName:r.data.fileName})),v(""),alert(r.data.message),console.log(r.data)}catch(r){console.error("Error uploading file:",r)}},X=t=>{I(t.target.files[0].name),O(t.target.files[0])},Y=async t=>{t.preventDefault();const a=V();if(console.log(i),Object.keys(a).length>0)D(a);else try{if(b){const r={...i,successstoryId:R,updatedBy:{userId:f.userId}};await fe(r,g)}else{const r={...i,createdBy:{userId:f.userId}};await Se(r,g)}p({successstoryName:"",description:"",photoName:""}),P.current.value=null,B(r=>!r),m(!1)}catch(r){console.error("Error saving news:",r)}},Z=()=>{w(!1),p({successstoryName:"",description:"",photoName:""}),m(!0)};return e.jsxs(te,{title:e.jsxs(F,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"SuccessStory"}),e.jsxs(x,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px"},onClick:Z,children:["Add",e.jsx(re,{sx:{color:"#fff"}})]})]}),children:[e.jsx(y,{container:!0,spacing:se}),e.jsxs(ae,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(ce,{sx:{maxHeight:440},children:e.jsxs(ie,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(le,{children:e.jsx(k,{children:U.map(t=>e.jsx(A,{align:t.align,style:{minWidth:t.minWidth,fontWeight:600,fontSize:15},children:t.label},t.id))})}),e.jsx(de,{children:N.slice(o*s,o*s+s).map(t=>e.jsx(k,{hover:!0,role:"checkbox",tabIndex:-1,children:U.map(a=>e.jsx(A,{align:a.align,children:a.id==="actions"?e.jsxs(e.Fragment,{children:[e.jsx(E,{onClick:()=>K(t.successstoryId),color:"primary",children:e.jsx(oe,{})}),e.jsx(E,{onClick:()=>q(t.successstoryId),color:"error",children:e.jsx(ne,{})})]}):t[a.id]},a.id))},t.successstoryId))})]})}),e.jsx(ue,{rowsPerPageOptions:[10,25,100],component:"div",count:N.length,rowsPerPage:s,page:o,onPageChange:H,onRowsPerPageChange:_})]}),e.jsxs(he,{open:M,onClose:()=>m(!1),fullWidth:!0,maxWidth:"md",children:[e.jsx(me,{sx:{fontSize:"16px"},children:b?"Edit SuccessStory":"Add SuccessStory"}),e.jsxs(F,{component:"form",onSubmit:Y,noValidate:!0,sx:{p:3},children:[e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:12,children:e.jsx(S,{fullWidth:!0,label:"SuccessStory Name",name:"successstoryName",value:i.successstoryName,onChange:T,error:!!u.successstoryName,helperText:u.successstoryName})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(S,{fullWidth:!0,label:"Description",name:"description",value:i.description,onChange:T,error:!!u.description,helperText:u.description,multiline:!0,rows:3})}),e.jsxs(y,{item:!0,xs:12,children:[e.jsx(S,{margin:"normal",fullWidth:!0,id:"photoName",label:"File Name",name:"photoName",autoComplete:"photoName",value:i.photoName,disabled:!0,helperText:u.photoName,error:!!u.photoName,InputProps:{endAdornment:e.jsx(x,{variant:"contained",color:"primary",onClick:Q,children:"Upload"})}}),e.jsx("input",{type:"file",onChange:X,ref:P,style:{marginTop:20}})]})]}),e.jsxs(pe,{children:[e.jsx(x,{onClick:()=>m(!1),children:"Cancel"}),e.jsx(x,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})]})]})]})};export{$e as default};
