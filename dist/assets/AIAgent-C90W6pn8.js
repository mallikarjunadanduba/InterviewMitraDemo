import{A as U,i as z,f as T,j as e,B as i,T as l,r as d,V as B,X as C,P as S,L as O,I as H,c as V}from"./index-So8Y0uMi.js";import{d as L}from"./Person-CF_kd-JY.js";import{T as q}from"./Tooltip-DG5ZkF-O.js";var K=U("brain","IconBrain",[["path",{d:"M15.5 13a3.5 3.5 0 0 0 -3.5 3.5v1a3.5 3.5 0 0 0 7 0v-1.8",key:"svg-0"}],["path",{d:"M8.5 13a3.5 3.5 0 0 1 3.5 3.5v1a3.5 3.5 0 0 1 -7 0v-1.8",key:"svg-1"}],["path",{d:"M17.5 16a3.5 3.5 0 0 0 0 -7h-.5",key:"svg-2"}],["path",{d:"M19 9.3v-2.8a3.5 3.5 0 0 0 -7 0",key:"svg-3"}],["path",{d:"M6.5 16a3.5 3.5 0 0 1 0 -7h.5",key:"svg-4"}],["path",{d:"M5 9.3v-2.8a3.5 3.5 0 0 1 7 0v10",key:"svg-5"}]]),M={},X=z;Object.defineProperty(M,"__esModule",{value:!0});var k=M.default=void 0,J=X(T()),N=e;k=M.default=(0,J.default)((0,N.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");var R={},G=z;Object.defineProperty(R,"__esModule",{value:!0});var F=R.default=void 0,Q=G(T()),Y=e;F=R.default=(0,Q.default)((0,Y.jsx)("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6z"}),"AttachFile");const Z=({text:m})=>{if(!m)return null;const u=m.split(/```/);return e.jsx(i,{sx:{p:1},children:u.map((n,s)=>s%2!==0?e.jsx(i,{component:"pre",sx:{bgcolor:"#f5f5f5",p:1.5,borderRadius:1,overflowX:"auto",fontFamily:"monospace",mb:2,fontSize:"14px",lineHeight:1.4},children:n.trim()},`code-${s}`):n.replace(/\*/g,"").replace(/([a-dA-D])\)/g,"$1) ").split(`
`).map(r=>r.trim()).filter(Boolean).map((r,c)=>/^\d+\.\s/.test(r)?e.jsx(i,{sx:{mb:1.5},children:e.jsx(l,{variant:"body2",sx:{fontWeight:500,lineHeight:1.6,color:"#1a1a1a"},children:r})},`num-${s}-${c}`):/^[a-dA-D][\.\)]\s/.test(r)?e.jsx(l,{variant:"body2",sx:{ml:3,mb:.5,lineHeight:1.5,color:"#333"},children:r},`opt-${s}-${c}`):/^[-â€¢]\s/.test(r)?e.jsx(l,{variant:"body2",sx:{ml:2,mb:.5,lineHeight:1.5,color:"#333"},children:r.replace(/^[-â€¢]\s/,"â€¢ ")},`bullet-${s}-${c}`):r.endsWith(":")&&r.length<50?e.jsx(l,{variant:"body1",sx:{fontWeight:600,mt:2,mb:1,color:"#1a1a1a",lineHeight:1.4},children:r},`heading-${s}-${c}`):r.length>0?e.jsx(l,{variant:"body2",sx:{mb:1.5,lineHeight:1.6,color:"#333",textAlign:"justify"},children:r},`p-${s}-${c}`):null))})},oe=()=>{const[m,u]=d.useState([{from:"bot",text:"Hi! I am your Interview Mitra Agent. How can I help you today?"}]),[n,s]=d.useState(""),[a,j]=d.useState(null),[r,c]=d.useState(!1),A=d.useRef(null),y=d.useRef(""),g=d.useRef(null);d.useEffect(()=>{var t;(t=A.current)==null||t.scrollIntoView({behavior:"smooth"})},[m]);const $=async()=>{if(!n.trim()&&!a)return;const t=a?{from:"user",text:`ðŸ“Ž ${a.name}`,fileUrl:URL.createObjectURL(a)}:{from:"user",text:n};u(o=>[...o,t]),s(""),c(!0);const x={from:"bot",text:""};u(o=>[...o,x]),y.current="";let D=null;try{let o;if(a){const h=new FormData;n&&h.append("message",n),a&&h.append("file",a),o=await fetch("http://localhost:8070/ws/ai/chat-stream-file",{method:"POST",body:h})}else o=await fetch("http://localhost:8070/ws/ai/chat-stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:n})});if(!o.ok||!o.body)throw new Error("Failed to connect to SSE endpoint");const p=o.body.getReader(),v=new TextDecoder("utf-8");let w="";for(D=setInterval(()=>{u(h=>{const b=[...h],f=b[b.length-1];return f.from==="bot"&&(f.text=y.current),[...b.slice(0,-1),f]})},50);;){const{value:h,done:b}=await p.read();if(b)break;w+=v.decode(h,{stream:!0});const f=w.split(`
`);for(let I=0;I<f.length-1;I++){const _=f[I].trim();if(_.startsWith("data:")){const P=_.replace(/^data:\s*/,"");y.current+=P}}w=f[f.length-1]}}catch(o){console.error(o),u(p=>[...p,{from:"bot",text:"Something went wrong. Please try again."}])}finally{clearInterval(D),u(o=>{const p=[...o],v=p[p.length-1];return v.from==="bot"&&(v.text=y.current),[...p.slice(0,-1),v]}),c(!1),j(null),g.current&&(g.current.value=null)}},W=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),$())},E=t=>{const x=t.target.files[0];x&&(j(x),t.target.value=null)};return e.jsxs(i,{sx:{height:"100%",display:"flex",flexDirection:"column",bgcolor:"#ffffff",position:"relative"},children:[e.jsx(i,{sx:{position:"fixed",top:0,left:0,right:0,zIndex:1e3,borderBottom:"1px solid #e5e5e5",bgcolor:"#ffffff",py:2,px:3},children:e.jsx(l,{variant:"h6",sx:{fontWeight:600,color:"#1a1a1a",textAlign:"center"},children:"Interview Mitra AI Agent"})}),e.jsx(i,{sx:{flex:1,overflow:"auto",bgcolor:"#ffffff",mt:"64px",mb:"200px"},children:e.jsxs(B,{maxWidth:"md",sx:{py:2},children:[m.map((t,x)=>e.jsxs(i,{sx:{display:"flex",justifyContent:t.from==="user"?"flex-end":"flex-start",mb:3,gap:2},children:[t.from==="bot"&&e.jsx(C,{sx:{width:32,height:32,bgcolor:"#10a37f",mt:.5},children:e.jsx(K,{size:16,color:"white"})}),e.jsx(i,{sx:{maxWidth:"80%",minWidth:"200px"},children:t.from==="bot"?e.jsx(S,{elevation:0,sx:{bgcolor:"#f7f7f8",borderRadius:"12px",p:2,border:"1px solid #e5e5e5"},children:e.jsx(Z,{text:t.text})}):e.jsx(S,{elevation:0,sx:{bgcolor:"#10a37f",borderRadius:"12px",p:2,color:"white"},children:t.fileUrl?e.jsx(l,{component:"a",href:t.fileUrl,download:!0,target:"_blank",rel:"noopener noreferrer",sx:{color:"white",textDecoration:"underline","&:hover":{color:"#e0e0e0"}},children:t.text}):e.jsx(l,{variant:"body1",sx:{whiteSpace:"pre-wrap",lineHeight:1.5},children:t.text})})}),t.from==="user"&&e.jsx(C,{sx:{width:32,height:32,bgcolor:"#10a37f",mt:.5},children:e.jsx(L,{fontSize:"small"})})]},x)),e.jsx("div",{ref:A})]})}),e.jsx(i,{sx:{position:"fixed",bottom:0,left:0,right:0,zIndex:1e3,borderTop:"1px solid #e5e5e5",bgcolor:"#ffffff",p:3},children:e.jsxs(B,{maxWidth:"md",children:[a&&e.jsx(i,{sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:e.jsx(O,{label:a.name,onDelete:()=>{j(null),g.current&&(g.current.value=null)},color:"primary",variant:"outlined",size:"small"})}),e.jsxs(S,{component:"form",elevation:0,sx:{display:"flex",alignItems:"flex-end",border:"1px solid #e5e5e5",borderRadius:"12px",p:1,bgcolor:"#ffffff","&:focus-within":{borderColor:"#10a37f",boxShadow:"0 0 0 2px rgba(16, 163, 127, 0.1)"}},onSubmit:t=>{t.preventDefault(),$()},children:[e.jsx(q,{title:"Attach a file",children:e.jsxs(H,{component:"label",sx:{p:1,color:"#666","&:hover":{color:"#10a37f"}},children:[e.jsx(F,{fontSize:"small"}),e.jsx("input",{ref:g,type:"file",hidden:!0,onChange:E})]})}),e.jsx(V,{fullWidth:!0,multiline:!0,maxRows:4,variant:"standard",placeholder:"Message Interview Mitra AI Agent...",value:n,onChange:t=>s(t.target.value),onKeyDown:W,InputProps:{disableUnderline:!0,style:{padding:"8px 12px",fontSize:"16px",lineHeight:1.5}},disabled:r,sx:{"& .MuiInputBase-root":{minHeight:"44px"}}}),e.jsx(H,{color:"primary",type:"submit",disabled:r||!n.trim()&&!a,sx:{p:1,color:!n.trim()&&!a?"#ccc":"#10a37f","&:hover":{bgcolor:"rgba(16, 163, 127, 0.1)"}},children:e.jsx(k,{fontSize:"small"})})]}),e.jsx(l,{variant:"caption",sx:{mt:1,textAlign:"center",color:"#666",display:"block"},children:"Interview Mitra AI Agent can make mistakes. Consider checking important information."})]})})]})};export{oe as default};
