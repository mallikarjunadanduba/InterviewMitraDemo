import{a as m,b as c,u as ee,r as i,j as e,M as te,G as f,g as ae,P as se,I as E,e as F,c as N,d as x}from"./index-So8Y0uMi.js";import{h as $}from"./moment-G82_0lEo.js";import{d as re}from"./Add-CKqOdQJH.js";import{d as ne}from"./Edit-C0O1oZMb.js";import{d as oe}from"./DeleteForever-CZXyAtfu.js";import{T as ie,a as le,b as de,c as k,d as A,e as ce}from"./TableRow-ByAOLB1Q.js";import{T as he}from"./TablePagination-Bq1iu1it.js";import{D as me,a as pe}from"./DialogTitle-B--fWyEw.js";import{D as ue}from"./DialogActions-Bk10_EIe.js";import"./LastPage-C7laYLYy.js";import"./MenuItem-CSdFaWhF.js";const ge=async(n,d)=>{try{return await m({method:"POST",url:`${c}/news/v1/createNews`,headers:d,data:n}).then(function(a){a.data.responseCode===201?alert("Advertisement  added successfully"):a.data.responseCode===400&&alert(a.data.errorMessage)})}catch(a){alert(a)}},fe=async n=>await m({method:"get",url:`${c}/news/v1/getAllNewsByPagination/{pageNumber}/{pageSize}?pageNumber=0&pageSize=10`,headers:n}),we=async(n,d)=>await m({method:"GET",url:`${c}/news/v1/getNewsById/{newsId}?newsId=${n}`,headers:d}),xe=async(n,d)=>(console.log(n),await m({method:"PUT",url:`${c}/news/v1/updateNews`,headers:d,data:n}).then(function(a){a.data.responseCode===201?alert(a.data.message):a.data.responseCode===400&&alert(a.data.errorMessage)}).catch(function(a){console.log(a)})),Ne=async(n,d)=>await m({method:"delete",url:`${c}/news/v1/deleteNewsById/${n}`,headers:d}).then(a=>{a.data.responseCode===200?alert(a.data.message):a.data.responseCode===400&&alert(a.data.errorMessage)}).catch(a=>{console.log(a)}),U=[{id:"newsId",label:"ID"},{id:"newsName",label:"Name",minWidth:100},{id:"description",label:"Description",minWidth:100},{id:"file",label:"File"},{id:"createdBy",label:"Created By",align:"right"},{id:"updatedBy",label:"Updated By",align:"right"},{id:"insertedDate",label:"Inserted Date",align:"right"},{id:"updatedDate",label:"Updated Date",align:"right"},{id:"actions",label:"Actions",align:"right"}],$e=()=>{ee();const[n,d]=i.useState(0),[a,W]=i.useState(10),[y,j]=i.useState([]),[b,I]=i.useState(!1),[M,p]=i.useState(!1),[R,z]=i.useState(null),[ye,D]=i.useState(""),[h,C]=i.useState({}),[P,O]=i.useState(null),S=i.useRef(null),[je,v]=i.useState(""),[G,B]=i.useState(!1),[l,u]=i.useState({newsName:"",description:""}),H=(t,s)=>{d(s)},_=t=>{W(+t.target.value),d(0)},w=JSON.parse(sessionStorage.getItem("user")),g={"Content-type":"application/json",Authorization:`Bearer ${w.accessToken}`},L=`${c}/file/downloadFile/?filePath=`,J=async()=>{try{const s=(await fe(g)).data.content;if(s){const r=s.map(o=>({newsId:o.newsId,newsName:o.newsName,description:o.description,file:o.photoPath?e.jsx("img",{src:L+o.photoPath,alt:o.photoName,style:{width:100,height:50}}):"NO IMAGE FOUND",insertedDate:$(o.insertedDate).format("L"),updatedDate:$(o.updatedDate).format("L"),createdBy:o.createdBy?o.createdBy.userName:"No User",updatedBy:o.updatedBy?o.updatedBy.userName:"No User"}));j(r)}else j([])}catch(t){console.error("Error fetching data:",t)}};i.useEffect(()=>{J()},[G]);const V=()=>{const t={};return l.newsName.trim()||(t.newsName="Enter the News"),l.description.trim()||(t.description="Enter the Description"),(!l.photoName||l.photoName.trim()==="")&&(t.photoName="Select the file"),t},T=t=>{u({...l,[t.target.name]:t.target.value}),C(s=>({...s,[t.target.name]:null}))},q=async t=>{try{await Ne(t,g),B(s=>!s)}catch(s){console.error("Error deleting news:",s)}},K=async t=>{I(!0),p(!0);try{const r=(await we(t,g)).data;z(r.newsId),u({newsName:r.newsName,description:r.description,photoName:r.photoName})}catch(s){console.error("Error fetching news by ID:",s)}},Q=async t=>{if(t.preventDefault(),!P){v("Please select a file");return}const s=new FormData;s.append("file",P);try{const r=await m.post(`${c}/file/uploadFile`,s,{headers:{"content-type":"multipart/form-data",Authorization:`Bearer ${w.accessToken}`}});D(r.data.fileName),u(o=>({...o,photoName:r.data.fileName})),v(""),alert(r.data.message),console.log(r.data)}catch(r){console.error("Error uploading file:",r)}},X=t=>{D(t.target.files[0].name),O(t.target.files[0])},Y=async t=>{t.preventDefault();const s=V();if(console.log(l),Object.keys(s).length>0)C(s);else try{if(b){const r={...l,newsId:R,updatedBy:{userId:w.userId}};await xe(r,g)}else{const r={...l,createdBy:{userId:w.userId}};await ge(r,g)}u({newsName:"",description:"",photoName:""}),S.current.value=null,B(r=>!r),p(!1)}catch(r){console.error("Error saving news:",r)}},Z=()=>{I(!1),u({newsName:"",description:"",photoName:""}),p(!0)};return e.jsxs(te,{title:e.jsxs(F,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"News"}),e.jsxs(x,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px"},onClick:Z,children:["Add",e.jsx(re,{sx:{color:"#fff"}})]})]}),children:[e.jsx(f,{container:!0,spacing:ae}),e.jsxs(se,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(ie,{sx:{maxHeight:440},children:e.jsxs(le,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(de,{children:e.jsx(k,{children:U.map(t=>e.jsx(A,{align:t.align,style:{minWidth:t.minWidth,fontWeight:600,fontSize:15},children:t.label},t.id))})}),e.jsx(ce,{children:y.slice(n*a,n*a+a).map(t=>e.jsx(k,{hover:!0,role:"checkbox",tabIndex:-1,children:U.map(s=>e.jsx(A,{align:s.align,children:s.id==="actions"?e.jsxs(e.Fragment,{children:[e.jsx(E,{onClick:()=>K(t.newsId),color:"primary",children:e.jsx(ne,{})}),e.jsx(E,{onClick:()=>q(t.newsId),color:"error",children:e.jsx(oe,{})})]}):t[s.id]},s.id))},t.newsId))})]})}),e.jsx(he,{rowsPerPageOptions:[10,25,100],component:"div",count:y.length,rowsPerPage:a,page:n,onPageChange:H,onRowsPerPageChange:_})]}),e.jsxs(me,{open:M,onClose:()=>p(!1),fullWidth:!0,maxWidth:"md",children:[e.jsx(pe,{sx:{fontSize:"16px"},children:b?"Edit News":"Add News"}),e.jsxs(F,{component:"form",onSubmit:Y,noValidate:!0,sx:{p:3},children:[e.jsxs(f,{container:!0,spacing:2,children:[e.jsx(f,{item:!0,xs:12,children:e.jsx(N,{fullWidth:!0,label:"News Name",name:"newsName",value:l.newsName,onChange:T,error:!!h.newsName,helperText:h.newsName})}),e.jsx(f,{item:!0,xs:12,children:e.jsx(N,{fullWidth:!0,label:"Description",name:"description",value:l.description,onChange:T,error:!!h.description,helperText:h.description,multiline:!0,rows:3})}),e.jsxs(f,{item:!0,xs:12,children:[e.jsx(N,{margin:"normal",fullWidth:!0,id:"photoName",label:"File Name",name:"photoName",autoComplete:"photoName",value:l.photoName,disabled:!0,helperText:h.photoName,error:!!h.photoName,InputProps:{endAdornment:e.jsx(x,{variant:"contained",color:"primary",onClick:Q,children:"Upload"})}}),e.jsx("input",{type:"file",onChange:X,ref:S,style:{marginTop:20}})]})]}),e.jsxs(ue,{children:[e.jsx(x,{onClick:()=>p(!1),children:"Cancel"}),e.jsx(x,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})]})]})]})};export{$e as default};
