import{j as e,B as S,T as l,c as ne,D as oe,P as re,r,Y as ae,d as R,u as ie,C as ce,a2 as de,U as le,G as E,az as H}from"./index-So8Y0uMi.js";import{E as ue,S as he,a as me}from"./ExamFooter-BDWwXu5v.js";import{s as xe,c as we}from"./MCATestApi-Ckt43_fe.js";const pe=({questionData:a,selectedAnswer:u,onAnswerChange:p,showAnswers:o})=>e.jsxs(S,{p:3,bgcolor:"white",borderRadius:2,boxShadow:1,children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Question"}),e.jsx(l,{variant:"caption",color:"textSecondary",display:"block",gutterBottom:!0,children:"(Write your answer in the text box below)"}),e.jsx(l,{variant:"body1",gutterBottom:!0,sx:{mb:3},children:a.question}),e.jsx(ne,{fullWidth:!0,multiline:!0,rows:6,variant:"outlined",placeholder:"Type your answer here...",value:u,onChange:p,sx:{"& .MuiOutlinedInput-root":{fontSize:"1rem",lineHeight:1.5}}}),o&&e.jsxs(S,{sx:{mt:3},children:[e.jsx(oe,{sx:{mb:2}}),e.jsxs(re,{elevation:2,sx:{p:2,bgcolor:"#e8f5e8",border:"1px solid #4caf50",borderRadius:2},children:[e.jsx(l,{variant:"h6",color:"success.main",gutterBottom:!0,children:"Correct Answer:"}),e.jsx(l,{variant:"body1",sx:{lineHeight:1.6},children:a.expectedAnswer}),a.wordLimit&&e.jsxs(l,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:["Suggested word limit: ",a.wordLimit," words"]})]})]})]}),ge=({initialTime:a,onSubmit:u,onExit:p,onShowAnswers:o,showAnswers:g})=>{const[n,b]=r.useState(a);return r.useEffect(()=>{const c=setInterval(()=>{b(y=>{const[h,x,k]=y.split(":").map(Number);let w=h*3600+x*60+k-1;if(w<=0)return clearInterval(c),u(),"00:00:00";const f=String(Math.floor(w/3600)).padStart(2,"0"),I=String(Math.floor(w%3600/60)).padStart(2,"0"),T=String(w%60).padStart(2,"0");return`${f}:${I}:${T}`})},1e3);return()=>clearInterval(c)},[u]),e.jsxs(S,{p:2,bgcolor:"rgba(102, 225, 228, 0.3)",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",children:[e.jsx(l,{variant:"h6",align:"center",sx:{mt:2},children:n}),e.jsx(l,{variant:"caption",align:"center",display:"block",sx:{mb:3},children:"Time Remaining"}),e.jsxs(ae,{spacing:2,width:"100%",children:[e.jsx(R,{variant:"contained",onClick:o,sx:{backgroundColor:g?"#ff9800":"#2196f3","&:hover":{backgroundColor:g?"#f57c00":"#1976d2"}},children:g?"Hide Answers":"Show Correct Answers"}),e.jsx(R,{variant:"contained",onClick:u,sx:{backgroundColor:"#43a047","&:hover":{backgroundColor:"#2e7d32"}},children:"Submit Practice"}),e.jsx(R,{variant:"contained",onClick:p,sx:{backgroundColor:"#e53935","&:hover":{backgroundColor:"#c62828"}},children:"Exit"})]})]})},Ae=()=>{const a=JSON.parse(sessionStorage.getItem("user")),u=ie(),p=ce(u.breakpoints.down("sm")),[o,g]=r.useState([]),[n,b]=r.useState(1),[c,y]=r.useState({}),[h,x]=r.useState({}),[k,w]=r.useState(0),[f,I]=r.useState(!1),T=de(),j=le(),{shortAnswerData:A=[],selectedTopic:P={},selectedMode:N=""}=T.state||{},D=a==null?void 0:a.seekerId,F=P==null?void 0:P.topicId,z=N,_={"Content-type":"application/json",Authorization:"Bearer "+a.accessToken};r.useEffect(()=>{if(!A.length)alert("No Short Answer data found. Redirecting..."),j("/jobs/short-answers-assessment");else{const t=A.slice(0,10).map((s,d)=>({id:s.shortAnswerId||d+1,question:s.question,expectedAnswer:s.expectedAnswer||"",wordLimit:s.wordLimit||100}));g(t)}},[A,j]),r.useEffect(()=>{const t=()=>{document.hidden&&alert("Tab change or minimize detected! Please stay on the exam page.")};return document.addEventListener("visibilitychange",t),()=>{document.removeEventListener("visibilitychange",t)}},[]),r.useEffect(()=>{const t=Date.now(),s=new BroadcastChannel("exam_channel");let d=0;const v=setTimeout(()=>{d>0&&alert("Exam is already active in another tab. Closing this one.")},200);return s.postMessage({type:"new_tab_check",tabId:t}),s.onmessage=C=>{const{type:i,tabId:m}=C.data;i==="new_tab_check"&&m!==t&&s.postMessage({type:"existing_tab_response",tabId:t}),i==="existing_tab_response"&&m!==t&&(d+=1,w(M=>M+1))},()=>{clearTimeout(v),s.close()}},[]),r.useEffect(()=>{const t=s=>s.preventDefault();return document.addEventListener("contextmenu",t),()=>{document.removeEventListener("contextmenu",t)}},[]);const O=t=>{const s=t.target.value;y({...c,[n]:s}),x({...h,[n]:"answered"})},U=()=>{x({...h,[n]:"review"}),b(t=>Math.min(t+1,o.length))},$=()=>{y({...c,[n]:""}),x({...h,[n]:"not_answered"})},G=()=>{const t=c[n]?"answered":"not_answered";x({...h,[n]:t}),b(s=>Math.min(s+1,o.length))},W=()=>{const t=o.length;let s=0;o.forEach((C,i)=>{const m=c[i+1];m&&m.trim()&&s++});const d=t-s,v=s>=t/2?"Pass":"Fail";return{total:t,attempted:s,unattempted:d,result:v}},q=async()=>{const{total:t,attempted:s,unattempted:d,result:v}=W(),C={seeker:{seekerId:D},topic:{topicId:F},mode:z,totalQuestions:t,attemptedQuestions:s,unattempted:d,tabSwitchCount:k,result:v};try{const i=await xe(C,_);console.log("Exam history saved:",i);const m=i.id,M=A.map((L,Z)=>{const ee=L.shortAnswerId,te=L.question,se=L.expectedAnswer||"",Q=c[Z+1]||"",B=Q.trim()!=="";return we({examHistoryId:m,questionId:ee,questionText:te,selectedAnswer:Q,correctAnswer:se,isCorrect:B,scoreAwarded:B?1:0,penaltyApplied:0},_)});await Promise.all(M),H.fire("Success","Short Answer Exam submitted successfully!","success"),j("/jobs/resultReview",{state:{historyId:i.id}})}catch(i){console.error("Failed to submit exam:",i),H.fire("Error","Failed to submit exam. Please try again.","error")}},J=()=>{window.confirm("Are you sure you want to exit the test?")&&j("/jobs/short-answers-assessment")},V=()=>{I(!f)},Y=o[n-1]||{question:"",wordLimit:100},K=c[n]||"",X=o.map((t,s)=>({id:s+1,status:h[s+1]||"not_answered"}));return e.jsxs(S,{display:"flex",flexDirection:"column",height:"100%",sx:{borderRadius:2,overflow:"hidden",boxShadow:3,bgcolor:"background.paper"},children:[e.jsx(ue,{currentPage:n,totalPages:o.length}),e.jsxs(E,{container:!0,flex:1,children:[e.jsx(E,{item:!0,xs:12,sm:3,md:2,sx:{display:p?"none":"block",borderRight:1,borderColor:"divider"},children:e.jsx(he,{totalQuestions:o.length,currentQuestion:n,onNavigate:b,questionStatus:X})}),e.jsx(E,{item:!0,xs:12,sm:6,md:8,p:2,children:e.jsx(pe,{questionData:Y,selectedAnswer:K,onAnswerChange:O,showAnswers:f})}),e.jsx(E,{item:!0,xs:12,sm:3,md:2,sx:{borderLeft:1,borderColor:"divider"},children:e.jsx(ge,{initialTime:"00:30:00",onSubmit:q,onExit:J,onShowAnswers:V,showAnswers:f})})]}),e.jsx(S,{children:e.jsx(me,{onMarkReview:U,onClear:$,onSave:G,onSubmit:q})})]})};export{Ae as default};
